<!-- Shared manifest section partial -->
<div class="manifest-section">
    <h3>ğŸ”— Your Stremio Manifest</h3>
    <p>Choose one of the addon manifests below:</p>

    <div id="manifests">
        <div class="manifest-group" data-type="combined" style="margin-bottom:1rem;">
            <div style="font-weight:600; margin-bottom:0.5rem;">Combined (Movies + Series)</div>
            <div class="manifest-url" style="display:none;">{{ manifest_urls.combined if manifest_urls else manifest_url }}</div>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button class="copy-btn" onclick="installStremioType('combined')" style="background: rgba(76, 175, 80, 0.3); border-color: rgba(76, 175, 80, 0.5); flex:1; min-width:120px;">ğŸ“± Stremio</button>
                <button class="copy-btn" onclick="installStremioWebType('combined')" style="background: rgba(33, 150, 243, 0.3); border-color: rgba(33, 150, 243, 0.5); flex:1; min-width:120px;">ğŸŒ Stremio Web</button>
                <button class="copy-btn" onclick="copyUrlType('combined')" style="flex:1; min-width:120px;">ğŸ“‹ Copy URL</button>
                <button class="copy-btn" onclick="toggleManifestVisibilityType('combined')" style="flex:1; min-width:120px;">ğŸ“„ Show Manifest</button>
            </div>
        </div>
        <div class="manifest-group" data-type="movie" style="margin-bottom:1rem;">
            <div style="font-weight:600; margin-bottom:0.5rem;">Movies Only</div>
            <div class="manifest-url" style="display:none;">{{ manifest_urls.movie if manifest_urls else '' }}</div>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button class="copy-btn" onclick="installStremioType('movie')" style="background: rgba(76, 175, 80, 0.3); border-color: rgba(76, 175, 80, 0.5); flex:1; min-width:120px;">ğŸ“± Stremio</button>
                <button class="copy-btn" onclick="installStremioWebType('movie')" style="background: rgba(33, 150, 243, 0.3); border-color: rgba(33, 150, 243, 0.5); flex:1; min-width:120px;">ğŸŒ Stremio Web</button>
                <button class="copy-btn" onclick="copyUrlType('movie')" style="flex:1; min-width:120px;">ğŸ“‹ Copy URL</button>
                <button class="copy-btn" onclick="toggleManifestVisibilityType('movie')" style="flex:1; min-width:120px;">ğŸ“„ Show Manifest</button>
            </div>
        </div>
        <div class="manifest-group" data-type="series" style="margin-bottom:0.5rem;">
            <div style="font-weight:600; margin-bottom:0.5rem;">Series Only</div>
            <div class="manifest-url" style="display:none;">{{ manifest_urls.series if manifest_urls else '' }}</div>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button class="copy-btn" onclick="installStremioType('series')" style="background: rgba(76, 175, 80, 0.3); border-color: rgba(76, 175, 80, 0.5); flex:1; min-width:120px;">ğŸ“± Stremio</button>
                <button class="copy-btn" onclick="installStremioWebType('series')" style="background: rgba(33, 150, 243, 0.3); border-color: rgba(33, 150, 243, 0.5); flex:1; min-width:120px;">ğŸŒ Stremio Web</button>
                <button class="copy-btn" onclick="copyUrlType('series')" style="flex:1; min-width:120px;">ğŸ“‹ Copy URL</button>
                <button class="copy-btn" onclick="toggleManifestVisibilityType('series')" style="flex:1; min-width:120px;">ğŸ“„ Show Manifest</button>
            </div>
        </div>
    </div>
</div>

<!-- Shared JavaScript for manifest functionality -->
<script>
    // Manifest URLs from server
    const manifestUrls = {
        combined: '{{ manifest_urls.combined if manifest_urls else manifest_url }}',
        movie: '{{ manifest_urls.movie if manifest_urls else "" }}',
        series: '{{ manifest_urls.series if manifest_urls else "" }}'
    };

    function getManifestUrlByType(type) {
        return manifestUrls[type] || manifestUrls.combined;
    }

    function toggleManifestVisibilityType(type) {
        const group = document.querySelector(`.manifest-group[data-type="${type}"]`);
        if (!group) return;
        const urlDiv = group.querySelector('.manifest-url');
        const btn = Array.from(group.querySelectorAll('.copy-btn')).find(b => b.textContent.includes('Show Manifest') || b.textContent.includes('Hide Manifest'));
        const show = urlDiv.style.display === 'none' || urlDiv.style.display === '';
        urlDiv.textContent = getManifestUrlByType(type);
        urlDiv.style.display = show ? 'block' : 'none';
        if (btn) btn.textContent = show ? 'ğŸ“„ Hide Manifest' : 'ğŸ“„ Show Manifest';
    }

    function installStremioType(type) {
        const manifestUrl = getManifestUrlByType(type);
        const cleanUrl = manifestUrl.replace(/^https?:\/\//, '');
        const stremioUrl = `stremio://${cleanUrl}`;
        window.open(stremioUrl, '_blank');
    }

    function installStremioWebType(type) {
        const manifestUrl = getManifestUrlByType(type);
        const webUrl = `https://web.stremio.com/#/addons?addon=${encodeURIComponent(manifestUrl)}`;
        window.open(webUrl, '_blank');
    }

    function copyUrlType(type) {
        const manifestUrl = getManifestUrlByType(type);
        copyToClipboard(manifestUrl);
    }
</script>